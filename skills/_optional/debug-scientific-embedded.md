---
name: debug-scientific-embedded
version: 1.0.0
description: >
  Режим научной отладки для Embedded. Запрещает "слепые фиксы".
  Требует формулирования гипотезы, плана инструментации (GPIO/Trace/Logs) и изоляции проблемы (HW vs SW).
tags: ["debug","scientific-method","instrumentation","gpio","trace","fault"]
project_context: "docs/PROJECT_CONTEXT.md"
when_to_use:
  - "когда что-то не работает, крашится, зависает или ведет себя странно"
  - "при отладке HIL-тестов или проблем на реальном железе"
  - "при расследовании HardFault, Watchdog reset или BusFault"
outputs:
  - "Наблюдение -> Гипотеза -> План измерений -> Анализ -> Решение"
---

# Skill: Scientific Debugging (Embedded)

## Миссия
Не гадать. Не предлагать "попробуйте поменять X на Y", если нет доказательств.
Лечить причину (Root Cause), а не симптом. В сварочном оборудовании "метод тыка" приводит к взрывам.

## Процесс (The Loop)
Ты обязан следовать этому циклу. Не перескакивай к решению.

### 1. Наблюдение (Observation)
- Что именно сломалось? (HardFault? Ложное срабатывание BKIN? ADC timeout?)
- Контекст: Под нагрузкой? В простое? При включении?
- Есть ли логи/дампы регистров?

### 2. Формирование гипотез (Hypothesis)
Выдвини 2-3 вероятные причины. Для Embedded всегда учитывай:
- **SW Logic:** Ошибка в коде, переполнение стека, гонка данных.
- **Timing/RTOS:** Overrun, джиттер, блокировка прерываний, инверсия приоритетов.
- **Hardware/EMI:** Помеха на линии, дребезг контактов, просадка питания, неверный уровень GPIO.

### 3. План эксперимента (Instrumentation)
Прежде чем менять код логики, предложи, как подтвердить гипотезу.
**Инструменты:**
- **GPIO Toggles:** "Подними пин DBG_1 при входе в ISR и опусти при выходе, смотри осциллографом джиттер/длительность."
- **Counters:** "Добавь атомарный счетчик ошибок CRC в структуру diag."
- **Trace/Log:** "Запиши в кольцевой буфер значения ADC за 10 мс до сбоя."
- **Hardware Isolation:** "Отключи силу (DRV_EN=0), воспроизводится ли?"

### 4. Анализ (Analysis)
Только после получения данных подтверди или опровергни гипотезу.

## Контракт ответа
Ответ должен быть структурирован так:
1.  **Анализ симптомов**: Что мы знаем точно.
2.  **Гипотезы**:
    - A (Вероятно): ...
    - B (Возможно): ...
3.  **План действий (ПЕРЕД фиксом)**:
    - Куда поставить `__BKPT()` или GPIO-тоггл.
    - Что проверить осциллографом (уровни, фронты).
    - Какой минимальный код добавить для диагностики.

## Запрещено
- Предлагать "слепые фиксы" (Blind Fixes) типа "добавь delay", "увеличь размер стека" без предварительного измерения.
- Игнорировать аппаратный фактор (помехи, питание).