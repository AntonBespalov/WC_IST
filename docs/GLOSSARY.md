# Словарь терминов проекта

Цель: одинаковое понимание терминов в команде (ПО/схема/тесты).
Если термин используется в документах/коде — он должен быть определён здесь.

---

## 1) Роли и подсистемы
**ТК (технологический комплекс)**  
Внешняя система верхнего уровня, которая выдаёт уставки/команды и принимает измерения/статусы источника.

**Источник (контроллер источника сварочного тока)**  
Устройство на STM32, которое управляет силовой частью, измеряет ток/напряжение и обеспечивает безопасное отключение при отказах.

**Силовая часть**  
Мощная электроника (инвертор/мост, трансформатор, силовые ключи), формирующая сварочный ток.

**Драйвер затвора (например, SKYPER 42 R)**  
Узел управления силовыми ключами (IGBT/MOSFET), часто имеющий входы PWM/EN и выходы FAULT/READY.

**FRAM (Ferroelectric RAM)**

Неволатильная память с быстрым чтением/записью; в проекте — резервная внешняя память для накопления данных осциллографирования/record-replay (см. `docs/PROJECT_CONTEXT.md` / раздел 7).

**CY15B104Q-PZXI**

Микросхема FRAM, подключаемая по QSPI (детали режимов и критериев переключения — TBD).

**QSPI (Quad SPI)**

Интерфейс последовательной памяти с 4-битной линией данных; используется для подключения внешней памяти.

---

## 2) Тайминги и real-time
**Период ШИМ (PWM period)**  
Период генерации ШИМ на TIM1, определяет частоту управления силовой частью (в проекте: 1–4 кГц).

**Шаг управления (control step)**  
Запуск регулятора и вычисление новых управляющих воздействий. Обычно привязан к событию таймера (например, раз в период ШИМ).

**Latency (задержка реакции)**  
Время от события (например, fault) до действия (например, PWM off). Пример: `BKIN_RAW → PWM_OUT safe`.

**Jitter (джиттер)**  
Разброс (нестабильность) момента наступления события относительно идеального расписания. Например, джиттер старта шага управления.

**Overrun (превышение времени выполнения)**  
Ситуация, когда вычисление/задача не укладывается в отведённый бюджет времени (например, 1 мс цикл).

**ISR (обработчик прерывания)**  
Код, выполняющийся по прерыванию. Не гарантирует безопасность сам по себе (может быть заблокирован/задержан).

---

## 3) Safety/аварии и поведение системы
**Safe state (безопасное состояние)**  
Состояние, в котором исключено формирование сварочного тока: ШИМ выключен аппаратно, драйверы запрещены (если есть EN/INH), авария обработана согласно политике.

**CBM706T (внешний супервизор / watchdog)**  
Внешний супервизор питания/сторож. Важный принцип: его **FAULT** используется для аппаратного запрета силовой части, а **RESET** — для восстановления (reset сам по себе не является safe state).

**Controlled stop (контролируемая остановка)**  
Остановка формирования тока/ШИМ по “мягкой” процедуре, когда есть время завершить действия ПО (в отличие от мгновенного аппаратного отключения).

**Fault (авария/неисправность)**  
Событие или состояние, требующее реакции системы (от информирования до немедленного отключения).

**Critical fault (критическая авария)**  
Авария, которая требует немедленного аппаратного отключения силовой части (без ожидания RTOS/ISR).

**Fault latch (защёлка аварии)**  
Политика, при которой после аварии система остаётся в запрещённом состоянии до явного восстановления (reset/команда/питание), чтобы избежать самопроизвольного рестарта.

**Recovery (восстановление)**  
Условия выхода из FAULT/запрета. Должны быть явно определены (команда reset, локальная кнопка, power-cycle и т.п.).

**Watchdog (сторожевой таймер)**  
Механизм обнаружения зависания ПО/МК. Важное требование: срабатывание watchdog должно приводить к safe state аппаратно.

---

## 4) TIM1, отключение и сигналы управления
**TIM1**  
Продвинутый таймер STM32 (advanced timer) с комплементарными выходами, dead-time и входами Break.

**BKIN / BKIN2 (Break input)**  
Вход(ы) аппаратного отключения выходов TIM1. Используются для мгновенного “рубильника” PWM при критических авариях.

**MOE (Main Output Enable)**  
Разрешение основных выходов advanced timer. Снятие MOE выключает выходы.

**AOE (Automatic Output Enable)**  
Автоматическое повторное включение выходов. По умолчанию в safety-контексте обычно считается нежелательным, чтобы не было авто-рестарта.

**Dead-time**  
Аппаратная пауза между переключениями комплементарных ключей для предотвращения сквозного тока.

**DRV_EN / INH / ENABLE**  
Отдельная линия разрешения драйвера (если предусмотрена). Желательно иметь независимым “вторым рубильником” помимо BKIN.

---

## 5) Измерения и качество данных
**Катушка Роговского (Rogowski coil)**  
Датчик тока, дающий сигнал, пропорциональный `di/dt`. Для получения `i(t)` используется интегратор (аналоговый или цифровой). Требует контроля нуля/дрейфа/насыщения.

**AD7380**  
Синхронный двухканальный АЦП (SPI). В проекте используется для измерения `I_weld` и `U_weld` вторички.

**RAW (сырые данные)**  
Необработанные коды АЦП (до масштабирования и фильтрации).

**Scaling (масштабирование)**  
Преобразование кодов АЦП в физические единицы (А, В) с учётом коэффициентов/калибровки.

**Filtering (фильтрация)**  
Алгоритм подавления шума/помех (например, mavg), параметры: окно, шаг обновления.

**Stuck detection (детект “залипа”)**  
Обнаружение ситуации, когда измерение не меняется (или меняется неестественно мало) слишком долго.

**Saturation (насыщение)**  
Измерение упёрлось в предел АЦП/тракта (верх/низ), часто признак неисправности или выхода за диапазон.

**Plausibility check (проверка правдоподобия)**  
Проверка “физической” адекватности данных (границы, dI/dt, корреляции каналов и т.п.).

---

## 6) Обмен с ТК и устойчивость связи
**Frame (кадр/сообщение)**  
Единица обмена по CAN и т.п., содержащая команды или статус.

**Seq counter (счётчик последовательности)**  
Поле, помогающее определить пропуски/повторы/перестановку сообщений.

**CRC (контрольная сумма)**  
Проверка целостности данных кадра.

**Timeout (таймаут)**  
Решение “связь пропала”, если в течение N мс не пришла команда/не получен ответ.

**Bus-off (CAN)**  
Состояние CAN-контроллера при серьёзных ошибках шины. Требует определённой политики реакции.

---

## 7) Тестирование и доказательства
**Test pyramid (пирамида тестов)**  
Иерархия: статические проверки → юнит host → интеграция on-target → HIL → силовой стенд.

**On-target (на целевом МК)**  
Тестирование на STM32, включая периферию, тайминги и реальные прерывания/RTOS.

**HIL (Hardware-in-the-loop)**  
Стенд, который эмулирует сигналы датчиков/АЦП, позволяя гонять прошивку без киловатт.

**Fault-injection (инъекция отказов)**  
Искусственное создание отказов (датчик, связь, драйвер, зависание) для проверки реакции и safe state.

**DFT (Design for Test)**  
Проектирование схемы/платы так, чтобы её можно было тестировать (тест-пойнты, режимы, инъекции сигналов).

**Test point (тест-пойнт)**  
Физическая площадка/контакт на плате для подключения осциллографа/логического анализатора.

**Instrumentation (инструментирование)**  
GPIO-тогглы, trace, счётчики, логи — всё, что превращает “кажется” в измерение.

**Record/Replay**  
Запись трассы (измерения/состояния/команды) в буфер с последующим анализом и воспроизведением алгоритмов оффлайн.

**Pre-trigger / Post-trigger**  
Окно записи до события (например, аварии) и после него; важно для диагностики причин.

---

## 8) Зарезервированные слова/коды (по желанию)
(Добавь сюда перечень стандартных состояний и кодов ошибок, когда определишь протокол)
- Состояния: IDLE / ARMED / WELD / FAULT / …
- Коды ошибок: DRIVER_FAULT / ADC_TIMEOUT / COMMS_TIMEOUT / CTRL_OVERRUN / …

---

## 9) Внутренние сигналы (рекомендованные имена)
**I_ref_cmd**  
Уставка, пришедшая от ТК (командная).

**I_ref_used**  
Уставка, реально поданная в быстрый контур после slew-rate/лимитов/безопасностной политики (обязательна к выдаче в телеметрию).
