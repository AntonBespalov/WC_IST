# Стандарт кода (язык комментариев и кодировка)

Цель: чтобы код и документы были читаемыми, совместимыми и не “разъезжались” по стилю.
Этот файл — требование для разработки в проекте (не только для Codex).

---

## 1) Язык комментариев

### 1.1 Базовое правило
- Комментарии и документация в коде — **на русском языке**.
- Допускаются англ. термины/аббревиатуры, если это стандарт индустрии (PWM, ISR, DMA, watchdog, latch, safe state, BKIN и т.п.).
- Имена идентификаторов/файлов/символов — как принято в кодовой базе (обычно латиница).

### 1.2 Что значит “достаточно комментариев”
Требование “исчерпывающих комментариев” трактуем инженерно, чтобы не получить тонны устаревающего текста:

MUST (обязательно комментировать):
- **контракты и инварианты** (что нельзя ломать) — особенно в safety/RT местах,
- **причину (rationale)** для нетривиальных решений,
- **границы ответственности** (кто имеет право менять PWM, кто выставляет fault/latch),
- **временные домены** (PWM/1мс/async fault) и точки синхронизации,
- **все safety‑ветки**: входы fault, latch/recovery, запрет “варки вслепую”.

SHOULD (желательно):
- публичные API функций/модулей (особенно если они используются из разных слоёв),
- нестандартные состояния FSM и переходы,
- “опасные” места: гонки ISR↔task, атомарность, DMA‑буферы.

SHALL NOT (не делаем):
- комментарии “в каждой строке”, повторяющие код,
- комментарии без указания причины (например “делаем delay 5 мкс” без источника/измерения).

### 1.3 Рекомендуемый формат
- Для публичных функций/структур: Doxygen‑стиль (кратко: назначение + аргументы + side effects + условия безопасности).
- Для safety‑логики: отдельный блок `// SAFETY:` с перечислением инвариантов/условий.

---

## 2) Кодировка файлов и окончания строк

### 2.1 Кодировка
- Все текстовые файлы проекта (включая `.c/.h`, `.md`) — **UTF‑8**.
- Рекомендуется **UTF‑8 без BOM** (во многих toolchain это наименее проблемный вариант).

### 2.2 Окончания строк
- В репозитории: **CRLF** (Windows‑style, чтобы совпадало с настройками STM32CubeIDE/Eclipse в проекте).

### 2.3 Где это зафиксировано
- `.editorconfig` в корне репозитория задаёт: `charset=utf-8`, `end_of_line=crlf` и базовые правила.

---

## 3) Стандарт языка C

- Целевой стандарт языка C для проекта: **GNU11** (C11 + GNU extensions), т.е. компиляция с `-std=gnu11`.
- Если для конкретной сборки требуется другое значение `-std=...`, это должно быть явно зафиксировано в настройках сборки и документировано (с причиной и областью действия).

---

## 4) Форматирование (отступы)
Для исходников C/C++ придерживаемся настроек STM32CubeIDE/Eclipse formatter:
- отступ: **2 пробела** (`indentation.size = 2`)
- табуляция: **2** (`tabulation.size = 2`)

Это отражено в `.editorconfig` для `*.{c,h,cpp,hpp,s,ld}`.

---

## 5) Как это использовать с Codex/LLM
- В запросах и при генерации кода следовать `AGENTS.md` и проектным skills из `.codex/skills/`, и ссылаться на этот стандарт.
- Если предлагается патч без нужных комментариев/описания инвариантов — считать задачу “не доделанной”.
