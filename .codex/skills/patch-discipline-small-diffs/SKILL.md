---
name: patch-discipline-small-diffs
version: 0.1.0
description: >
  Правила работы маленькими патчами: минимальные диффы, не трогать лишнее, разбивка на коммиты,
  запрет “скрытых рефакторингов”. Уместно почти для любого изменения прошивки.
tags: ["process","patch","diff","review"]
when_to_use:
  - "генерация кода/правок в прошивке"
  - "подготовка PR/ревью"
outputs:
  - "Ограничение области изменений + список затронутых файлов + план коммитов"
---

# Skill: Patch discipline — маленькие диффы

## Миссия
Делать изменения управляемыми: минимальный риск, простой ревью, понятная причина каждого изменения.

## MUST
- **Минимальный дифф**: менять только то, что требуется для цели.
- **Не трогать лишнее**: не переименовывать/не форматировать/не рефакторить соседний код без причины.
- **Ограничить область**: явно перечислить файлы/модули, которые можно менять.
- **Соблюдать стандарт кода**: комментарии на русском и требования к UTF-8/CRLF по `docs/CODING_STANDARD_RU.md`.
- **STM32CubeIDE**: если патч добавляет новую папку с кодом — обновить include paths и `sourceEntries` в `.cproject` (см. `docs/HOW_TO_USE_RU.md` / раздел 5).
- **Разбивка на шаги** (если изменение крупнее):
  1) инфраструктура/тесты,
  2) функциональное изменение,
  3) (опционально) рефакторинг *после* и отдельным коммитом.
- **Стабильные интерфейсы**: не менять публичные API модулей без явного запроса.

## SHOULD
- Если нужен рефакторинг — сделать его отдельным PR или отдельным коммитом с “нулевой” функциональной разницей.
- Для критичных изменений — сначала добавить доказательства (тесты/измерения), потом менять логику.

## Контракт ответа
- Список затронутых файлов.
- Что НЕ будет изменено (явно).
- План коммитов (1–3 пункта) и критерии готовности.

## Нельзя
- “Большой комбайн-патч” с перемешанными рефакторингом и логикой.
- Изменения форматирования во множестве файлов без необходимости.
